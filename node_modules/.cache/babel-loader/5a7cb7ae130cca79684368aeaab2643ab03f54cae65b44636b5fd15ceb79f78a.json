{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport { createStore } from 'vuex';\nimport auth0 from 'auth0-js';\nimport router from '../router';\nimport axios from 'axios';\nimport { validate } from 'vee-validate';\nexport default createStore({\n  state: {\n    userIsAuthorized: false,\n    auth0: new auth0.WebAuth({\n      domain: process.env.VUE_APP_Healtchain_AUTH0_DOMAIN,\n      clientID: process.env.VUE_APP_Healtchain_AUTH0_CLIENTID,\n      redirectUri: process.env.VUE_APP_DOMAINURL + '/callback',\n      responseType: process.env.VUE_APP_AUTH0_CONFIG_RESPONSETYPE,\n      scope: process.env.VUE_APP_AUTH0_CONFIG_SCOPE\n    })\n  },\n  getters: {},\n  mutations: {\n    setUserIsAuthenticated(state, replacement) {\n      state.userIsAuthorized = replacement;\n    }\n  },\n  actions: {\n    auth0Login(context) {\n      context.state.auth0.authorize();\n    },\n    auth0HandleAuthentication(context) {\n      context.state.auth0.parseHash((err, authResult) => {\n        if (authResult && authResult.accessToken && authResult.idToken) {\n          let expiresAt = JSON.stringify(authResult.expiresIn * 1000 + new Date().getTime());\n          // save the tokens locally\n          localStorage.setItem('access_token', authResult.accessToken);\n          localStorage.setItem('id_token', authResult.idToken);\n          localStorage.setItem('expires_at', expiresAt);\n          console.log(authResult.accessToken);\n          console.log(authResult.idToken);\n          console.log(expiresAt);\n          const userData = [];\n          userData = validateUser();\n          //Condicional si ya tiene un tipo de usuario lo envio a su home correspondiente\n          if (userData.user_type == 1) {\n            router.replace('/home');\n          } else if (userData.user_type == 2) {\n            router.replace('/home');\n            //si no tiene un home correspondiente lo envio a seleccionar su tipo de usuario\n          } else if (userData.user_type == null) {\n            router.replace('/seleccionUsuario');\n          }\n        } else if (err) {\n          alert('login failed. Error #KJN838');\n          router.replace('/login');\n          console.log(err);\n        }\n      });\n    },\n    auth0Logout(context) {\n      // No need to update the bearer in global axiosConfig to null because we are redirecting out of the application\n      // Clear Access Token and ID Token from local storage\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('id_token');\n      localStorage.removeItem('expires_at');\n\n      // redirect to auth0 logout to completely log the user out\n      window.location.href = process.env.VUE_APP_AUTH0_CONFIG_DOMAINURL + \"/v2/logout?returnTo=\" + process.env.VUE_APP_DOMAINURL + \"/login&client_id=\" + process.env.VUE_APP_Healtchain_AUTH0_CLIENTID;\n    },\n    decodeToken() {\n      const token = localStorage.getItem('id_token');\n      const base64Url = token.split('.')[1];\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(''));\n      return JSON.parse(jsonPayload);\n    },\n    validateUser() {\n      const jsonPayload = decodeToken();\n      const userData = [];\n      axios.get(\"https://localhost:7151/api/User/ValidateUser/\" + jsonPayload.email.toString()).then(response => {\n        this.userData = response.data;\n      }).catch(err => {\n        alert(err.data);\n      });\n      return userData;\n    }\n  },\n  modules: {}\n});","map":{"version":3,"names":["createStore","auth0","router","axios","validate","state","userIsAuthorized","WebAuth","domain","process","env","VUE_APP_Healtchain_AUTH0_DOMAIN","clientID","VUE_APP_Healtchain_AUTH0_CLIENTID","redirectUri","VUE_APP_DOMAINURL","responseType","VUE_APP_AUTH0_CONFIG_RESPONSETYPE","scope","VUE_APP_AUTH0_CONFIG_SCOPE","getters","mutations","setUserIsAuthenticated","replacement","actions","auth0Login","context","authorize","auth0HandleAuthentication","parseHash","err","authResult","accessToken","idToken","expiresAt","JSON","stringify","expiresIn","Date","getTime","localStorage","setItem","console","log","userData","validateUser","user_type","replace","alert","auth0Logout","removeItem","window","location","href","VUE_APP_AUTH0_CONFIG_DOMAINURL","decodeToken","token","getItem","base64Url","split","base64","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","parse","get","email","then","response","data","catch","modules"],"sources":["R:/Agus/Facultad/TFI 5to/healthchain-front/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\r\nimport auth0 from 'auth0-js'\r\nimport router from '../router'\r\nimport axios from 'axios'\r\nimport { validate } from 'vee-validate'\r\n\r\nexport default createStore({\r\n  state: {\r\n    userIsAuthorized:false,\r\n    auth0: new auth0.WebAuth({\r\n      domain: process.env.VUE_APP_Healtchain_AUTH0_DOMAIN, \r\n      clientID: process.env.VUE_APP_Healtchain_AUTH0_CLIENTID,\r\n      redirectUri: process.env.VUE_APP_DOMAINURL + '/callback',  \r\n      responseType: process.env.VUE_APP_AUTH0_CONFIG_RESPONSETYPE,\r\n      scope: process.env.VUE_APP_AUTH0_CONFIG_SCOPE})\r\n  },\r\n  getters: {\r\n  },\r\n  mutations: {\r\n    setUserIsAuthenticated(state, replacement){\r\n      state.userIsAuthorized = replacement;\r\n    }\r\n  },\r\n  actions: {\r\n    auth0Login(context){\r\n      context.state.auth0.authorize()\r\n    },\r\n    auth0HandleAuthentication (context) {\r\n      context.state.auth0.parseHash((err, authResult) => {\r\n        if (authResult && authResult.accessToken && authResult.idToken) {\r\n          let expiresAt = JSON.stringify(\r\n            authResult.expiresIn * 1000 + new Date().getTime()\r\n          )\r\n          // save the tokens locally\r\n          localStorage.setItem('access_token', authResult.accessToken);\r\n          localStorage.setItem('id_token', authResult.idToken);\r\n          localStorage.setItem('expires_at', expiresAt);  \r\n          console.log(authResult.accessToken)\r\n          console.log(authResult.idToken)\r\n          console.log(expiresAt)\r\n          const userData = []\r\n          userData = validateUser()\r\n          //Condicional si ya tiene un tipo de usuario lo envio a su home correspondiente\r\n          if(userData.user_type == 1){\r\n            router.replace('/home')\r\n          }\r\n          else if(userData.user_type == 2){\r\n            router.replace('/home')\r\n          //si no tiene un home correspondiente lo envio a seleccionar su tipo de usuario\r\n          }else if(userData.user_type == null){\r\n            router.replace('/seleccionUsuario');\r\n          }\r\n        } \r\n        else if (err) {\r\n          alert('login failed. Error #KJN838');\r\n          router.replace('/login');\r\n          console.log(err);\r\n        }\r\n      })\r\n    },\r\n    auth0Logout (context) {\r\n      // No need to update the bearer in global axiosConfig to null because we are redirecting out of the application\r\n      // Clear Access Token and ID Token from local storage\r\n      localStorage.removeItem('access_token');\r\n      localStorage.removeItem('id_token');\r\n      localStorage.removeItem('expires_at');\r\n\r\n      // redirect to auth0 logout to completely log the user out\r\n      window.location.href = process.env.VUE_APP_AUTH0_CONFIG_DOMAINURL + \"/v2/logout?returnTo=\" + process.env.VUE_APP_DOMAINURL + \"/login&client_id=\" + process.env.VUE_APP_Healtchain_AUTH0_CLIENTID; \r\n    },\r\n    decodeToken(){\r\n      const token = localStorage.getItem('id_token')\r\n      const base64Url = token.split('.')[1];\r\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {\r\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n      }).join(''));\r\n      return JSON.parse(jsonPayload)\r\n    },\r\n    validateUser(){\r\n      const jsonPayload = decodeToken();\r\n      const userData = [];\r\n      axios.get(\"https://localhost:7151/api/User/ValidateUser/\" + jsonPayload.email.toString())\r\n              .then(response=>{\r\n                this.userData = response.data;\r\n              })\r\n              .catch(err =>{\r\n                alert(err.data)\r\n              })\r\n      return userData;\r\n    }    \r\n  },\r\n  modules: {\r\n  }\r\n})\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}